<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The function oneStepAhead computes successive one-step-ahead
  predictions for a (random effects) HHH model fitted by hhh4.
  These can be inspected using the quantile, confint or
  plot methods.
  The associated scores-method computes a number of (strictly) proper
  scoring rules based on such one-step-ahead predictions;
  see Paul and Held (2011) for details.
  There are also calibrationTest and pit
  methods for oneStepAhead predictions.  
Scores, calibration tests and PIT histograms can also be
  computed for the fitted values of an hhh4 model
  (i.e., in-sample/training data evaluation)."><title>Predictive Model Assessment for hhh4 Models — hhh4_validation • surveillance</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Predictive Model Assessment for hhh4 Models — hhh4_validation"><meta property="og:description" content="The function oneStepAhead computes successive one-step-ahead
  predictions for a (random effects) HHH model fitted by hhh4.
  These can be inspected using the quantile, confint or
  plot methods.
  The associated scores-method computes a number of (strictly) proper
  scoring rules based on such one-step-ahead predictions;
  see Paul and Held (2011) for details.
  There are also calibrationTest and pit
  methods for oneStepAhead predictions.  
Scores, calibration tests and PIT histograms can also be
  computed for the fitted values of an hhh4 model
  (i.e., in-sample/training data evaluation)."><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@bastistician"><meta name="twitter:site" content="@bastistician"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">surveillance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.20.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/pkgdown/overview.html">Overview</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/pkgdown/events.html">Events</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/pkgdown/bibliography.html">Bibliography</a>
</li>
      </ul><ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Predictive Model Assessment for <code>hhh4</code> Models</h1>
      
      <div class="d-none name"><code>hhh4_validation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function <code>oneStepAhead</code> computes successive one-step-ahead
  predictions for a (random effects) HHH model fitted by <code><a href="hhh4.html">hhh4</a></code>.
  These can be inspected using the <code>quantile</code>, <code>confint</code> or
  <code>plot</code> methods.
  The associated <code><a href="scores.html">scores</a></code>-method computes a number of (strictly) proper
  scoring rules based on such one-step-ahead predictions;
  see Paul and Held (2011) for details.
  There are also <code><a href="calibration.html">calibrationTest</a></code> and <code><a href="pit.html">pit</a></code>
  methods for <code>oneStepAhead</code> predictions.</p>  
<p>Scores, calibration tests and PIT histograms can also be
  computed for the fitted values of an <code>hhh4</code> model
  (i.e., in-sample/training data evaluation).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">oneStepAhead</span><span class="op">(</span><span class="va">result</span>, <span class="va">tp</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rolling"</span>, <span class="st">"first"</span>, <span class="st">"final"</span><span class="op">)</span>,</span>
<span>             which.start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"current"</span>, <span class="st">"final"</span><span class="op">)</span>,</span>
<span>             keep.estimates <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="va">type</span> <span class="op">!=</span> <span class="st">"final"</span>,</span>
<span>             cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for oneStepAhead</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">90</span>, <span class="fl">97.5</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for oneStepAhead</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">parm</span>, level <span class="op">=</span> <span class="fl">0.95</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for oneStepAhead</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, unit <span class="op">=</span> <span class="fl">1</span>, probs <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">99</span><span class="op">/</span><span class="fl">100</span>,</span>
<span>     start <span class="op">=</span> <span class="cn">NULL</span>, means.args <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## assessment of "oneStepAhead" predictions</span></span>
<span><span class="co"># S3 method for oneStepAhead</span></span>
<span><span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span><span class="va">x</span>, which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logs"</span>, <span class="st">"rps"</span>, <span class="st">"dss"</span>, <span class="st">"ses"</span><span class="op">)</span>,</span>
<span>       units <span class="op">=</span> <span class="cn">NULL</span>, sign <span class="op">=</span> <span class="cn">FALSE</span>, individual <span class="op">=</span> <span class="cn">FALSE</span>, reverse <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for oneStepAhead</span></span>
<span><span class="fu"><a href="calibration.html">calibrationTest</a></span><span class="op">(</span><span class="va">x</span>, units <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for oneStepAhead</span></span>
<span><span class="fu"><a href="pit.html">pit</a></span><span class="op">(</span><span class="va">x</span>, units <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## assessment of the "hhh4" model fit (in-sample predictions)</span></span>
<span><span class="co"># S3 method for hhh4</span></span>
<span><span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span><span class="va">x</span>, which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logs"</span>, <span class="st">"rps"</span>, <span class="st">"dss"</span>, <span class="st">"ses"</span><span class="op">)</span>,</span>
<span>       subset <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">control</span><span class="op">$</span><span class="va">subset</span>, units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">nUnit</span><span class="op">)</span>, sign <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for hhh4</span></span>
<span><span class="fu"><a href="calibration.html">calibrationTest</a></span><span class="op">(</span><span class="va">x</span>,</span>
<span>                subset <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">control</span><span class="op">$</span><span class="va">subset</span>, units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">nUnit</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for hhh4</span></span>
<span><span class="fu"><a href="pit.html">pit</a></span><span class="op">(</span><span class="va">x</span>, subset <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">control</span><span class="op">$</span><span class="va">subset</span>, units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">nUnit</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>result</dt>
<dd><p>fitted <code><a href="hhh4.html">hhh4</a></code> model (class <code>"hhh4"</code>).</p></dd>

  <dt>tp</dt>
<dd><p>numeric vector of length 2 specifying the time range in
    which to compute one-step-ahead predictions (for the time points
    <code>tp[1]+1</code>, ..., <code>tp[2]+1</code>).
    If a single time index is specified, it is interpreted as
    <code>tp[1]</code>, and <code>tp[2]</code> is set to the penultimate time point
    of <code>result$control$subset</code>.</p></dd>

  <dt>type</dt>
<dd><p>The default <code>"rolling"</code> procedure sequentially 
    refits the model up to each time point in <code>tp</code> and computes
    the one-step-ahead predictions for the respective next time point.
    The alternative <code>type</code>s are no true one-step-ahead predictions
    but much faster:
    <code>"first"</code> will refit the model for the first time point
    <code>tp[1]</code> only and use this specific fit to calculate all
    subsequent predictions, whereas
    <code>"final"</code> will just use <code>result</code> to calculate these.
    The latter case thus gives nothing else than a subset of
    <code>result$fitted.values</code> if the <code>tp</code>'s are part of the
    fitted subset <code>result$control$subset</code>.</p></dd>

  <dt>which.start</dt>
<dd><p>Which initial parameter values should be used when successively
    refitting the model to subsets of the data (up to time point
    <code>tp[1]</code>, up to <code>tp[1]+1</code>, ...) if <code>type="rolling"</code>?
    Default (<code>"current"</code>) is to use the parameter estimates from the
    previous time point, and <code>"final"</code> means to always
    use the estimates from <code>result</code> as initial values.
    Alternatively, <code>which.start</code> can be a list of <code>start</code>
    values as expected by <code><a href="hhh4.html">hhh4</a></code>, which then replace
    the corresponding estimates from <code>result</code> as initial values.
    This argument is ignored for “non-rolling” <code>type</code>s.</p></dd>

  <dt>keep.estimates</dt>
<dd><p>logical indicating if parameter estimates and log-likelihoods from
    the successive fits should be returned.</p></dd>

  <dt>verbose</dt>
<dd><p>non-negative integer (usually in the range <code>0:3</code>) specifying
    the amount of tracing information to output.
    During <code>hhh4</code> model updates, the following verbosity is used:
    <code>0</code> if <code>cores &gt; 1</code>, otherwise <code>verbose-1</code> if there
    is more than one time point to predict, otherwise <code>verbose</code>.</p></dd>

  <dt>cores</dt>
<dd><p>the number of cores to use when computing
    the predictions for the set of time points <code>tp</code> in parallel
    (with <code><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></code>).
    Note that parallelization is not possible in the default setting
    <code>type="rolling"</code> and <code>which.start="current"</code> (use
    <code>which.start="final"</code> for this to work).</p></dd>


  <dt>object</dt>
<dd><p>an object of class <code>"oneStepAhead"</code>.</p></dd>

  <dt>parm</dt>
<dd><p>unused (argument of the generic).</p></dd>

  <dt>level</dt>
<dd><p>required confidence level of the prediction interval.</p></dd>

  <dt>probs</dt>
<dd><p>numeric vector of probabilities with values in [0,1].</p></dd>

  <dt>unit</dt>
<dd><p>single integer or character selecting a unit for which to
    produce the plot.</p></dd>

  <dt>start</dt>
<dd><p>x-coordinate of the first prediction. If <code>start=NULL</code>
    (default), this is derived from <code>x</code>.</p></dd>

  <dt>means.args</dt>
<dd><p>if a list (of graphical parameters for <code><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></code>),
    the point predictions (from <code>x$pred</code>) are added to the plot.</p></dd>

  
  <dt>x</dt>
<dd><p>an object of class <code>"oneStepAhead"</code> or <code>"hhh4"</code>.</p></dd>

  <dt>which</dt>
<dd><p>character vector determining which scores to compute.
    The package <span class="pkg">surveillance</span> implements the following proper
    scoring rules: logarithmic score (<code>"logs"</code>), ranked probability
    score (<code>"rps"</code>), Dawid-Sebastiani score (<code>"dss"</code>), and
    squared error score (<code>"ses"</code>). The normalized SES
    (<code>"nses"</code>) is also available but it is improper and hence not
    computed by default.<br>
    It is possible to name own scoring rules in <code>which</code>. These
    must be functions of <code>(x, mu, size)</code>, vectorized in all arguments
    (time x unit matrices) except that <code>size</code> is <code>NULL</code>
    in case of a Poisson model.
    See the available scoring rules for guidance, e.g., <code><a href="scores.html">dss</a></code>.</p></dd>

  <dt>subset</dt>
<dd><p>subset of time points for which to calculate the scores
    (or test calibration, or produce the PIT histogram, respectively).
    Defaults to the subset used for fitting the model.</p></dd>

  <dt>units</dt>
<dd><p>integer or character vector indexing the units for which
    to compute the scores (or the calibration test or the PIT histogram,
    respectively). By default, all units are considered.</p></dd>

  <dt>sign</dt>
<dd><p>logical indicating if the function should also return
    <code>sign(x-mu)</code>, i.e., the sign of the difference between
    the observed counts and corresponding predictions.
    This does not really make sense when averaging over multiple
    <code>units</code> with <code>individual=FALSE</code>.</p></dd>

  <dt>individual</dt>
<dd><p>logical indicating if the individual scores of the
    <code>units</code> should be returned. By default (<code>FALSE</code>), the
    individual scores are averaged over all <code>units</code>.</p></dd>

  <dt>reverse</dt>
<dd><p>logical indicating if the rows (time points) should be
    reversed in the result. The long-standing but awkward default was to
    do so for the <code>oneStepAhead</code>-method. This has changed in
    version 1.16.0, so time points are no longer reversed by default.</p></dd>

  <dt>...</dt>
<dd><p>Unused by the <code>quantile</code>, <code>confint</code> and
    <code>scores</code> methods.<br>
    The <code>plot</code>-method passes further arguments to the
    <code><a href="fanplot.html">fanplot</a></code> function, e.g., <code>fan.args</code>,
    <code>observed.args</code>, and <code>key.args</code> can be used to modify the
    plotting style.<br>
    For the <code>calibrationTest</code>-method, further arguments are passed
    to <code><a href="calibration.html">calibrationTest.default</a></code>, e.g., <code>which</code> to
    select a scoring rule.<br>
    For the <code>pit</code>-methods, further arguments are passed to
    <code><a href="pit.html">pit.default</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><code>oneStepAhead</code> returns a list (of class <code>"oneStepAhead"</code>)
with the following components:</p>
<dl><dt>pred</dt>
<dd><p>one-step-ahead predictions in a matrix, where each row
  corresponds to one of the time points requested via the argument
  <code>tp</code>, and which has <code>ncol(result$stsObj)</code>
  unit-specific columns. The rownames indicate the predicted time points
  and the column names are identical to <code>colnames(result$stsObj)</code>.</p></dd>

<dt>observed</dt>
<dd><p>matrix with observed counts at the predicted time
  points. It has the same dimensions and names as <code>pred</code>.</p></dd>

<dt>psi</dt>
<dd><p>in case of a negative-binomial model, a matrix of the
  estimated overdispersion parameter(s) at each time point on 
  the internal -log-scale (1 column if <code>"NegBin1"</code>,
  <code>ncol(observed)</code> columns if <code>"NegBinM"</code> or shared overdispersion). 
  For a <code>"Poisson"</code> model, this component is <code>NULL</code>.</p></dd>

<dt>allConverged</dt>
<dd><p>logical indicating if all successive fits
  converged.</p></dd>


</dl><p>If <code>keep.estimates=TRUE</code>, there are the following additional elements:</p>
<dl><dt>coefficients</dt>
<dd><p>matrix of estimated regression parameters from the successive fits.</p></dd>

<dt>Sigma.orig</dt>
<dd><p>matrix of estimated variance parameters from the successive fits.</p></dd>

<dt>logliks</dt>
<dd><p>matrix with columns <code>"loglikelihood"</code> and
  <code>"margll"</code> with their obvious meanings.</p></dd>


</dl><p>The <code>quantile</code>-method computes quantiles of the one-step-ahead
forecasts. If there is only one unit, it returns a tp x prob matrix,
otherwise a tp x unit x prob array.
The <code>confint</code>-method is a convenient wrapper with <code>probs</code> set
according to the required confidence level.</p>


<p>The function <code>scores</code> computes the scoring rules specified in the
argument <code>which</code>.
If multiple <code>units</code> are selected and <code>individual=TRUE</code>, the
result is an array of dimensions
<code>c(nrow(pred),length(units),5+sign)</code> (up to <span class="pkg">surveillance</span></p>


<p>1.8-0, the first two dimensions were collapsed to give a matrix).
Otherwise, the result is a matrix with <code>nrow(pred)</code> rows and
<code>5+sign</code> columns. If there is only one predicted time point, the
first dimension is dropped in both cases.</p>



<p>The <code><a href="calibration.html">calibrationTest</a></code>- and <code><a href="pit.html">pit</a></code>-methods are
just convenient wrappers around the respective default methods.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Czado, C., Gneiting, T. and Held, L. (2009):
    Predictive model assessment for count data.
    <em>Biometrics</em>, <b>65</b> (4), 1254-1261.
    <a href="https://doi.org/10.1111/j.1541-0420.2009.01191.x" class="external-link">doi:10.1111/j.1541-0420.2009.01191.x</a></p>
<p>Paul, M. and Held, L. (2011):
    Predictive assessment of a non-linear random effects model for
    multivariate time series of infectious disease counts.
    <em>Statistics in Medicine</em>, <b>30</b> (10), 1118-1136.
    <a href="https://doi.org/10.1002/sim.4177" class="external-link">doi:10.1002/sim.4177</a></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sebastian Meyer and Michaela Paul</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>vignette("hhh4")</code> and <code>vignette("hhh4_spacetime")</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co">### univariate salmonella agona count time series</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"salmonella.agona"</span><span class="op">)</span></span>
<span><span class="co">## convert from old "disProg" to new "sts" class</span></span>
<span><span class="va">salmonella</span> <span class="op">&lt;-</span> <span class="fu"><a href="disProg2sts.html">disProg2sts</a></span><span class="op">(</span><span class="va">salmonella.agona</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## generate formula for temporal and seasonal trends</span></span>
<span><span class="va">f.end</span> <span class="op">&lt;-</span> <span class="fu"><a href="addSeason2formula.html">addSeason2formula</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span> <span class="op">+</span> <span class="va">t</span>, S<span class="op">=</span><span class="fl">1</span>, period<span class="op">=</span><span class="fl">52</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>f <span class="op">=</span> <span class="op">~</span><span class="fl">1</span><span class="op">)</span>, end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">f.end</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"NegBin1"</span><span class="op">)</span></span>
<span><span class="co">## fit the model</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="hhh4.html">hhh4</a></span><span class="op">(</span><span class="va">salmonella</span>, <span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## do sequential one-step-ahead predictions for the last 5 weeks</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu">oneStepAhead</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="fl">5</span>, type<span class="op">=</span><span class="st">"rolling"</span>,</span>
<span>                     which.start<span class="op">=</span><span class="st">"final"</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">pred</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## simple plot of the 80% one-week-ahead prediction interval</span></span>
<span><span class="co">## and point forecasts</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"fanplot"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>,<span class="fl">.9</span><span class="op">)</span>, means.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># \dontshow{</span></span>
<span><span class="co">## test equivalence of parallelized version</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"unix"</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">pred</span>,</span>
<span>        <span class="fu">oneStepAhead</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="fl">5</span>, type<span class="op">=</span><span class="st">"rolling"</span>,</span>
<span>                     which.start<span class="op">=</span><span class="st">"final"</span>, verbose<span class="op">=</span><span class="cn">FALSE</span>, cores<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># }</span></span>
<span></span>
<span><span class="co">## note: oneStepAhead(..., type="final") just means fitted values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu">oneStepAhead</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="fl">5</span>, type<span class="op">=</span><span class="st">"final"</span><span class="op">)</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## compute scores of the one-step-ahead predictions</span></span>
<span><span class="op">(</span><span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## the above uses the scores-method for "oneStepAhead" predictions,</span></span>
<span><span class="co">## which is a simple wrapper around the default method:</span></span>
<span><span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">observed</span>, mu <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">pred</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">psi</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## scores with respect to the fitted values are similar</span></span>
<span><span class="op">(</span><span class="va">scFitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span><span class="va">result</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># \dontshow{</span></span>
<span><span class="co">## test that scFitted is equivalent to scores(oneStepAhead(..., type = "final"))</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>    <span class="va">scFitted</span>,</span>
<span>    <span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span><span class="fu">oneStepAhead</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="fl">5</span>, type<span class="op">=</span><span class="st">"final"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># }</span></span>
<span></span>
<span></span>
<span><span class="co">## test if the one-step-ahead predictions are calibrated</span></span>
<span><span class="fu"><a href="calibration.html">calibrationTest</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span>  <span class="co"># p = 0.8746</span></span>
<span></span>
<span><span class="co">## the above uses the calibrationTest-method for "oneStepAhead" predictions,</span></span>
<span><span class="co">## which is a simple wrapper around the default method:</span></span>
<span><span class="fu"><a href="calibration.html">calibrationTest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">observed</span>, mu <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">pred</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">psi</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## we can also test calibration of the fitted values</span></span>
<span><span class="co">## using the calibrationTest-method for "hhh4" fits</span></span>
<span><span class="fu"><a href="calibration.html">calibrationTest</a></span><span class="op">(</span><span class="va">result</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## plot a (non-randomized) PIT histogram for the predictions</span></span>
<span><span class="fu"><a href="pit.html">pit</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## the above uses the pit-method for "oneStepAhead" predictions,</span></span>
<span><span class="co">## which is a simple wrapper around the default method:</span></span>
<span><span class="fu"><a href="pit.html">pit</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">observed</span>, pdistr <span class="op">=</span> <span class="st">"pnbinom"</span>, mu <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">pred</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">psi</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">### multivariate measles count time series</span></span>
<span><span class="co">## (omitting oneStepAhead forecasts here to keep runtime low)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"measlesWeserEms"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## simple hhh4 model with random effects in the endemic component</span></span>
<span><span class="va">measlesModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>f <span class="op">=</span> <span class="fu"><a href="addSeason2formula.html">addSeason2formula</a></span><span class="op">(</span><span class="op">~</span><span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="hhh4_formula.html">ri</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"iid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    ar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>f <span class="op">=</span> <span class="op">~</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    family <span class="op">=</span> <span class="st">"NegBin1"</span><span class="op">)</span></span>
<span><span class="va">measlesFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="hhh4.html">hhh4</a></span><span class="op">(</span><span class="va">measlesWeserEms</span>, control <span class="op">=</span> <span class="va">measlesModel</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## assess overall (in-sample) calibration of the model, i.e.,</span></span>
<span><span class="co">## if the observed counts are from the fitted NegBin distribution</span></span>
<span><span class="fu"><a href="calibration.html">calibrationTest</a></span><span class="op">(</span><span class="va">measlesFit</span><span class="op">)</span> <span class="co"># default is DSS (not suitable for low counts)</span></span>
<span><span class="fu"><a href="calibration.html">calibrationTest</a></span><span class="op">(</span><span class="va">measlesFit</span>, which <span class="op">=</span> <span class="st">"rps"</span><span class="op">)</span>  <span class="co"># p = 0.9322</span></span>
<span><span class="fu"><a href="calibration.html">calibrationTest</a></span><span class="op">(</span><span class="va">measlesFit</span>, which <span class="op">=</span> <span class="st">"logs"</span><span class="op">)</span> <span class="co"># p = 0.7238</span></span>
<span></span>
<span><span class="co">## to assess calibration in the second year for a specific district</span></span>
<span><span class="fu"><a href="calibration.html">calibrationTest</a></span><span class="op">(</span><span class="va">measlesFit</span>, subset <span class="op">=</span> <span class="fl">53</span><span class="op">:</span><span class="fl">104</span>, units <span class="op">=</span> <span class="st">"03452"</span>, which <span class="op">=</span> <span class="st">"rps"</span><span class="op">)</span></span>
<span><span class="fu"><a href="pit.html">pit</a></span><span class="op">(</span><span class="va">measlesFit</span>, subset <span class="op">=</span> <span class="fl">53</span><span class="op">:</span><span class="fl">104</span>, units <span class="op">=</span> <span class="st">"03452"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">### For a more sophisticated multivariate analysis of</span></span>
<span><span class="co">### areal time series of influenza counts - data("fluBYBW") -</span></span>
<span><span class="co">### see the (computer-intensive) demo("fluBYBW") script:</span></span>
<span><span class="va">demoscript</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"demo"</span>, <span class="st">"fluBYBW.R"</span><span class="op">)</span>,</span>
<span>                          package <span class="op">=</span> <span class="st">"surveillance"</span><span class="op">)</span></span>
<span><span class="va">demoscript</span></span>
<span><span class="co">#file.show(demoscript)</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Maintained by <a href="http://www.imbe.med.uni-erlangen.de/cms/sebastian_meyer.html" class="external-link">Sebastian Meyer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.9000. Hosted on <a href="https://R-forge.R-project.org/projects/surveillance/" class="external-link"><img src="https://r-forge.r-project.org/themes/rforge/imagesrf/logo.png" height="18" alt="R-Forge"></a></p>
</div>

    </footer></div>

  

  </body></html>

