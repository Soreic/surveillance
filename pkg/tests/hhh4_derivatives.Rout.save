
R version 3.1.3 (2015-03-09) -- "Smooth Sidewalk"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> suppressPackageStartupMessages(library("surveillance", quietly = TRUE))
> 
> ## fit a complex hhh4 model (without random effects)
> data("measlesWeserEms")
> measlesModel <- list(
+     end = list(f = addSeason2formula(~1 + t, S=1, period=52),
+                offset = population(measlesWeserEms)),
+     ar = list(f = ~1),
+     ne = list(f = ~1 + log(pop), weights = W_powerlaw(maxlag = 5)),
+     family = "NegBin1", data = list(pop = population(measlesWeserEms))
+ )
> measlesFit <- hhh4(measlesWeserEms, measlesModel)
> summary(measlesFit, maxEV = TRUE)

Call: 
hhh4(stsObj = measlesWeserEms, control = measlesModel)

Coefficients:
                        Estimate   Std. Error
ar.1                    -0.499636   0.121781 
ne.1                     0.551345   1.274013 
ne.log(pop)              0.960932   0.453889 
end.1                   -0.153586   0.281013 
end.t                    0.003333   0.004598 
end.sin(2 * pi * t/52)   1.015000   0.210643 
end.cos(2 * pi * t/52)  -0.588739   0.191922 
neweights.d              5.527826   1.879843 
overdisp                 1.819156   0.265017 

Epidemic dominant eigenvalue:  0.76 

Log-likelihood:   -962.81 
AIC:              1943.62 
BIC:              1992.84 

Number of units:        17 
Number of time points:  103 

> 
> ## check score function and fisher info against numerical approximations
> if (requireNamespace("numDeriv", quietly = TRUE)) {
+     capture.output(
+         pencomp <- hhh4(measlesWeserEms, measlesModel,
+                         check.analyticals = "numDeriv")$pen
+     )
+     stopifnot(
+         all.equal(pencomp$score$analytic, pencomp$score$numeric,
+                   tolerance = .Machine$double.eps^0.5),
+         all.equal(pencomp$fisher$analytic, pencomp$fisher$numeric,
+                   tolerance = .Machine$double.eps^0.25)
+     )
+ }
> 
> proc.time()
   user  system elapsed 
  3.651   0.073   3.705 
